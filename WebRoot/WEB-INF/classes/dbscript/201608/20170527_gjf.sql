### 汤已更新
ALTER TABLE jyjcyp
  ADD COLUMN userid VARCHAR(255) DEFAULT NULL COMMENT '操作员id控制编辑和删除用'  AFTER hviewjgztid;

UPDATE jyjcyp a set a.userid=(SELECT MAX(userid) FROM sysuser t WHERE t.username=a.jcypczy);

###
drop table pcompanynddtpj;
CREATE TABLE pcompanynddtpj (
  pcompanynddtpjid varchar(32) NOT NULL COMMENT '企业年度动态评级表ID',
  comid varchar(32) DEFAULT NULL COMMENT '企业ID',
  pdyear varchar(4) DEFAULT NULL COMMENT '评定年度',
  lhfjndpddj varchar(10) DEFAULT NULL COMMENT '量化分级年度评定等级',
  aae011 varchar(30) DEFAULT NULL COMMENT '操作员',
  aae036 datetime DEFAULT NULL COMMENT '操作时间',
  aae013 varchar(100) DEFAULT NULL COMMENT '备注',
  pdjgscfs varchar(10) DEFAULT NULL COMMENT '评定结果生产方式0自动1手动',
  PRIMARY KEY (pcompanynddtpjid)
)
ENGINE = INNODB
AVG_ROW_LENGTH = 163
CHARACTER SET utf8
COLLATE utf8_general_ci
COMMENT = '企业年度动态评级表';




ALTER TABLE hjhb
  ADD COLUMN jhsjfxsztid VARCHAR(32) DEFAULT NULL COMMENT '上级分销商主体id' AFTER jhsjfxid;

CREATE TABLE hjhb2 AS SELECT * FROM hjhb;

UPDATE hjhb a set a.jhsjfxsztid=(
    case when (a.jhsjfxid='' || a.jhsjfxid IS NULL)  then a.jhgysid
    else (SELECT t1.hviewjgztid FROM hjhb2 t1 WHERE t1.hjhbid=a.jhsjfxid) 
    end
  )
  
DROP TABLE hjhb2;

#############################################################20170515 以下汤为更新
drop table if exists hjcjgjcyqb;

/*==============================================================*/
/* Table: hjcjgjcyqb                                            */
/*==============================================================*/
create table hjcjgjcyqb
(
   hjcjgjcyqbid         varchar(32) not null comment '检测机构检测仪器表id',
   hviewjgztid          varchar(32) comment '监管主体id',
   jcyqmc               varchar(50) comment '检测仪器名称',
   jcyqxh               varchar(50) comment '检测仪器型号',
   jcyqxlh              varchar(50) comment '检测仪器序列号',
   jcyqgmrq             datetime comment '检测仪器购买日期',
   jcyqscrq             datetime comment '检测仪器生产日期',
   jcyqsccj             varchar(100) comment '检测仪器生产厂家',
   jcyqjcxm             varchar(1000) comment '检测仪器检测项目',
   jcyqcpyt             varchar(500) comment '检测仪器产品用途',
   aae011               varchar(32) comment '操作员',
   aae036               datetime comment '操作时间',
   primary key (hjcjgjcyqbid)
);

alter table hjcjgjcyqb comment '检测机构检测仪器表';



call PRC_INSERTCODE('JHJCQK','进货检测情况','1','0','无检测数据无检测图片','199405',null,@P_CODE,@P_MSG);
call PRC_INSERTCODE('JHJCQK','进货检测情况','1','1','有检测数据','199405',null,@P_CODE,@P_MSG);
call PRC_INSERTCODE('JHJCQK','进货检测情况','1','2','有检测图片','199405',null,@P_CODE,@P_MSG);
call PRC_INSERTCODE('JHJCQK','进货检测情况','1','3','有检测数据有检测图片','199405',null,@P_CODE,@P_MSG);


CREATE DEFINER = 'root'@'%'
FUNCTION syjzhpt.fun_jinhuojiance(prm_hjhbid  varchar(32))
  RETURNS varchar(40) CHARSET utf8
BEGIN
  #返回值说明0无检测数据无检测图片1有检测数据2有检测图片3有检测数据有检测图片 aaa100=jhjcqk
  declare v_ret VARCHAR(20); 
  declare v_count_data int DEFAULT 0; 
  declare v_count_pic int DEFAULT 0; 
    
    SELECT COUNT(*)
    INTO v_count_data
    FROM hjyjczb 
    WHERE jcztbzjid=prm_hjhbid;

    SELECT COUNT(*)
    INTO v_count_pic
    FROM fj 
    WHERE fjwid=prm_hjhbid
      AND fjtype='9';

    if (v_count_data=0 and v_count_pic=0) then
         set v_ret=0;
    end IF;

    IF (v_count_data>0 && v_count_pic=0) then
         set v_ret=1;
    end IF;
    IF (v_count_data=0 && v_count_pic>0) then
         set v_ret=2;
    end IF;
    IF (v_count_data>0 && v_count_pic>0) then
         set v_ret=3;
    end IF;

    return v_ret;

END


INSERT INTO aa10(AAA100, AAA102, AAA103, AAE030, AAE031, AAZ093, AAZ094, AAA104, AAA101, AAA105, aaa106, aaa107, aae011, aae036) VALUES
('FJTYPE', '12', '进货索证索票', 199405, NULL, '2017051619033612914372620', '1456', NULL, NULL, NULL, NULL, NULL, NULL, NULL);

########################################0517wei
INSERT INTO aa10(AAA100, AAA102, AAA103, AAE030, AAE031, AAZ093, AAZ094, AAA104, AAA101, AAA105, aaa106, aaa107, aae011, aae036) VALUES
('FJTYPE', '13', '进货抽检报告', 199405, NULL, '2017051711033612914372620', '1456', NULL, NULL, NULL, NULL, NULL, NULL, NULL);

drop table if exists hjdjccybg;

/*==============================================================*/
/* Table: hjdjccybg                                             */
/*==============================================================*/
create table hjdjccybg
(
   hjdjccybgid          varchar(32) not null comment '监督检查抽样报告id',
   hviewjgztid          varchar(32) comment '监管主体表主键',
   jcypid               varchar(32) comment '商品ID',
   rwly                 varchar(50) comment '任务来源',
   jdcysj               datetime comment '监督抽样时间',
   cyr                  varchar(100) comment '抽样人',
   cydw                 varchar(100) comment '抽样单位',
   aae011               varchar(32) comment '操作员',
   aae036               datetime comment '操作时间',
   primary key (hjdjccybgid)
);

alter table hjdjccybg comment '监督检查抽样报告';

INSERT INTO sysfunction(FUNCTIONID, LOCATION, TITLE, PARENT, ORDERNO, TYPE, DESCRIPTION, LOG, OWNER, ACTIVE, FUNCTIONCODE, VISIBLE, BIZID, ROLBIZCLASS, IMAGEURL, EXPANDEDIMAGEURL, AAA102, CAE005, ROLBIZABLE, TARGET, SYSTEMCODE) VALUES
('2017051616421652484497160', '/tmsyjhtgl/jianceyiqiIndex', '检测机构检测仪器设置', '2017032214445093628409569', 1, '1', NULL, NULL, NULL, NULL, NULL, '1', 'jianceyiqiIndex', NULL, NULL, NULL, NULL, NULL, NULL, '', '');
INSERT INTO sysfunction(FUNCTIONID, LOCATION, TITLE, PARENT, ORDERNO, TYPE, DESCRIPTION, LOG, OWNER, ACTIVE, FUNCTIONCODE, VISIBLE, BIZID, ROLBIZCLASS, IMAGEURL, EXPANDEDIMAGEURL, AAA102, CAE005, ROLBIZABLE, TARGET, SYSTEMCODE) VALUES
('2017051714594765080338795', '/tmsyjhtgl/chouyangbaogaoIndex', '监督检查抽验报告', '2017032214445093628409569', 1, '1', NULL, NULL, NULL, NULL, NULL, '1', 'chouyangbaogaoIndex', NULL, NULL, NULL, NULL, NULL, NULL, '', '');



INSERT INTO sysrole(ROLEID, ROLEDESC, ROLENAME, SYSROLEFLAG, ORGID) VALUES
('2017050808505220967617753', '生产企业角色', '生产企业角色', '0', '410523000000');

INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363151453871472', '2017050808505220967617753', '1128', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363153039403905', '2017050808505220967617753', '1140', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363153062814527', '2017050808505220967617753', '1129', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363153065383515', '2017050808505220967617753', '1130', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363153093545803', '2017050808505220967617753', '1131', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363154519001811', '2017050808505220967617753', '1170', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363154533552960', '2017050808505220967617753', '1175', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363154539002092', '2017050808505220967617753', '1145', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363154580995675', '2017050808505220967617753', '1171', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363156116318830', '2017050808505220967617753', '2016050515294914039976580', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363156127423204', '2017050808505220967617753', '2016072116140769936331429', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363156183577160', '2017050808505220967617753', '2016072214071768654950925', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363156184398991', '2017050808505220967617753', '2016072214071538377182520', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363157612296440', '2017050808505220967617753', '1168', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363157631363991', '2017050808505220967617753', '2016072515314432685156509', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363157653624393', '2017050808505220967617753', '2016111115543384153628412', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363157665358260', '2017050808505220967617753', '2016111115515277239988931', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363157678056076', '2017050808505220967617753', '2016072317553786528854416', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363159258708458', '2017050808505220967617753', '1192', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363159264915467', '2017050808505220967617753', '1193', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363159266005593', '2017050808505220967617753', '1191', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363159272218694', '2017050808505220967617753', '1194', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363160843303081', '2017050808505220967617753', '1198', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363160849244097', '2017050808505220967617753', '1195', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363160865846225', '2017050808505220967617753', '2017041817390364575796424', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363160866400906', '2017050808505220967617753', '2017041916571293079333091', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363162311683790', '2017050808505220967617753', '2017050820453522759657844', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363162342269541', '2017050808505220967617753', '2017050615020527956371204', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363162350870423', '2017050808505220967617753', '2017041916583910846359731', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363162364709461', '2017050808505220967617753', '2017051714594765080338795', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363162382367473', '2017050808505220967617753', '2017051616421652484497160', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363163921695325', '2017050808505220967617753', '2017050908303528517240127', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363163934339347', '2017050808505220967617753', '2017050820482339842850665', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363163951157553', '2017050808505220967617753', '2017050908335353385832710', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363163956019656', '2017050808505220967617753', '2017050908321813658292769', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363163987815949', '2017050808505220967617753', '2017050820472184850934380', NULL);
INSERT INTO sysrolefunction(ROLEFUNCTIONID, ROLEID, FUNCTIONID, CHECKTYPE) VALUES
('2017051719363165437423740', '2017050808505220967617753', '2017050908343525948469451', NULL);


ALTER TABLE zxpdcjxx
CHANGE COLUMN comdm comid varchar(50) DEFAULT NULL COMMENT '企业表主键';






